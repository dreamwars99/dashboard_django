<!-- corporate/templates/corporate/index_cor.html -->
{% extends 'ui/base.html' %}
{% load static %}

{% block title %}KB ê¸°ì—… ?¬ì‹  ?¬ì‚¬ ?€?œë³´??% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'corporate/styles_cor.css' %}">
{% endblock %}

{% block head_scripts %}
  <script src="{% static 'corporate/index_cor.js' %}" defer></script>
{% endblock %}

{% block header %}
  <div class="kb-header__titles">
    <h1 class="kb-header__title">AI ê¸°ë°˜ ê¸°ì—… ?¬ì‹  ?¬ì‚¬ ?•ë³´ë³´ë“œ</h1>
    <p class="kb-header__subtitle">ë²•ì¸ ì°¨ì£¼ ë¶„ì„ Â· ê¶Œê³  ?œë„ Â· ?´ê·œ ê·¼ê±°ë¥????”ë©´?ì„œ</p>
  </div>
{% endblock %}

{% block left_panel %}
  <div class="kb-card-stack">
    <!-- ?Œì‚¬ ë©”í??°ì´???…ë ¥: ê°’ì? state.meta???€?¥ë˜???”ì•½ ?ì—­ê³??°ì¸¡ ë¡œê·¸??ë°˜ì˜?©ë‹ˆ?? -->
          <section class="kb-card card" aria-labelledby="basicInfoTitle">
            <h2 class="card__title" id="basicInfoTitle">ê¸°ì—… ê¸°ë³¸?•ë³´</h2>
            <div class="kb-form">
              <div class="form-group with-tooltip">
                <label class="form-label" for="companyName">?Œì‚¬ëª?/label>
                <input id="companyName" type="text" class="form-input" placeholder="?? KB?Œí¬?? />
              </div>
              <div class="form-group with-tooltip">
                <label class="form-label" for="regNo">?¬ì—…?ë“±ë¡ë²ˆ??/ ì¢…ëª©ì½”ë“œ</label>
                <input id="regNo" type="text" class="form-input" placeholder="?? 123-45-67890" />
              </div>
              <div class="form-group with-tooltip">
                <label class="form-label" for="industry">?…ì¢…(KSIC)</label>
                <input id="industry" type="text" class="form-input" placeholder="?? C26 ?„ìë¶€?? />
              </div>
              <div class="form-group with-tooltip">
                <label class="form-label" for="fiscalYear">?Œê³„?°ë„</label>
                <select id="fiscalYear" class="form-select">
                  <option value="">?°ë„ ? íƒ</option>
                  <option>2022</option>
                  <option>2023</option>
                  <option>2024</option>
                </select>
              </div>
              <div class="form-actions">
                <button id="btnFetchData" type="button" class="kb-btn kb-btn--ghost" aria-label="DART ?ëŠ” ?¬ë‚´ DB?ì„œ ë¶ˆëŸ¬?¤ê¸°">DART/?¬ë‚´ DB ë¶ˆëŸ¬?¤ê¸°</button>
              </div>
            </div>
          </section>

          <!-- ?¬ë¬´ ?˜ì¹˜ ?…ë ¥: ?«ìë¥?ì¡°ì •?˜ë©´ bindInputs()ê°€ state.fin??ê°±ì‹ ?˜ê³  recalcAndRender()ê°€ ì¤‘ì•™ ?œê°?”ë? ?¤ì‹œ ê³„ì‚°?©ë‹ˆ?? -->
          <section class="kb-card card" aria-labelledby="financeInputTitle">
            <h2 class="card__title" id="financeInputTitle">?µì‹¬ ?¬ë¬´ ?…ë ¥</h2>
            <div class="form-section">
              <h3 class="form-section__title">ë§¤ì¶œ Â· ?ìµ</h3>
              <div class="form-group with-tooltip">
                <label class="form-label" for="netSales">ë§¤ì¶œ??Net sales) <span class="unit">(?µì›)</span></label>
                <span class="form-tooltip" data-tooltip="?¨ìœ„???µì› Â· ?Œìˆ˜ ?…ë ¥ ê¸ˆì?">??/span>
                <input id="netSales" type="number" min="0" inputmode="decimal" class="form-input" placeholder="?? 5200" />
              </div>
              <div class="form-group with-tooltip">
                <label class="form-label" for="cogs">ë§¤ì¶œ?ê?(COGS) <span class="unit">(?µì›)</span></label>
                <span class="form-tooltip" data-tooltip="?ê???ë§¤ì¶œ?¡ì„ ì´ˆê³¼?????†ìŠµ?ˆë‹¤">??/span>
                <input id="cogs" type="number" min="0" inputmode="decimal" class="form-input" placeholder="?? 3600" />
              </div>
              <div class="form-group with-tooltip">
                <label class="form-label" for="da">ê°ê??ê°ë¹?Depreciation &amp; amortization) <span class="unit">(?µì›)</span></label>
                <span class="form-tooltip" data-tooltip="?¨ìœ„???µì› Â· ?Œìˆ˜ ?…ë ¥ ê¸ˆì?">??/span>
                <input id="da" type="number" min="0" inputmode="decimal" class="form-input" placeholder="?? 210" />
              </div>
              <div class="form-group with-tooltip">
                <label class="form-label" for="ebit">?ì—…?´ìµ(EBIT) <span class="unit">(?µì›)</span></label>
                <span class="form-tooltip" data-tooltip="?¨ìœ„???µì›">??/span>
                <input id="ebit" type="number" inputmode="decimal" class="form-input" placeholder="?? 430" />
              </div>
              <div class="form-group with-tooltip">
                <label class="form-label" for="netIncome">?¹ê¸°?œì´??Net Income) <span class="unit">(?µì›)</span></label>
                <span class="form-tooltip" data-tooltip="?¨ìœ„???µì›">??/span>
                <input id="netIncome" type="number" inputmode="decimal" class="form-input" placeholder="?? 270" />
              </div>
            </div>

            <div class="form-section">
              <h3 class="form-section__title">?ì‚° Â· ë¶€ì±?/h3>
              <div class="form-group with-tooltip">
                <label class="form-label" for="inventory">?¬ê³ ?ì‚°(Inventory) <span class="unit">(?µì›)</span></label>
                <span class="form-tooltip" data-tooltip="?¨ìœ„???µì› Â· ?Œìˆ˜ ?…ë ¥ ê¸ˆì?">??/span>
                <input id="inventory" type="number" min="0" inputmode="decimal" class="form-input" placeholder="?? 620" />
              </div>
              <div class="form-group with-tooltip">
                <label class="form-label" for="receivables">ë§¤ì¶œì±„ê¶Œ(Total Receivables) <span class="unit">(?µì›)</span></label>
                <span class="form-tooltip" data-tooltip="?¨ìœ„???µì›">??/span>
                <input id="receivables" type="number" min="0" inputmode="decimal" class="form-input" placeholder="?? 830" />
              </div>
              <div class="form-group with-tooltip">
                <label class="form-label" for="currentAssets">? ë™?ì‚°(Current assets) <span class="unit">(?µì›)</span></label>
                <span class="form-tooltip" data-tooltip="?¨ìœ„???µì›">??/span>
                <input id="currentAssets" type="number" min="0" inputmode="decimal" class="form-input" placeholder="?? 3100" />
              </div>
              <div class="form-group with-tooltip">
                <label class="form-label" for="currentLiab">? ë™ë¶€ì±?Total Current Liabilities) <span class="unit">(?µì›)</span></label>
                <span class="form-tooltip" data-tooltip="?¨ìœ„???µì›">??/span>
                <input id="currentLiab" type="number" min="0" inputmode="decimal" class="form-input" placeholder="?? 1850" />
              </div>
              <div class="form-group with-tooltip">
                <label class="form-label" for="ltDebt">?¥ê¸°ì°¨ì…ê¸?Total Long-term debt) <span class="unit">(?µì›)</span></label>
                <span class="form-tooltip" data-tooltip="?¨ìœ„???µì› Â· ?Œìˆ˜ ?…ë ¥ ê¸ˆì?">??/span>
                <input id="ltDebt" type="number" min="0" inputmode="decimal" class="form-input" placeholder="?? 1150" />
              </div>
            </div>

            <div class="form-section">
              <h3 class="form-section__title">?ë³¸ Â· ê¸°í?</h3>
              <div class="form-group with-tooltip">
                <label class="form-label" for="retainedEarnings">?´ìµ?‰ì—¬ê¸?Retained Earnings) <span class="unit">(?µì›)</span></label>
                <span class="form-tooltip" data-tooltip="?¨ìœ„???µì›">??/span>
                <input id="retainedEarnings" type="number" inputmode="decimal" class="form-input" placeholder="?? 950" />
              </div>
              <div class="form-group with-tooltip">
                <label class="form-label" for="mktValue">?œê?ì´ì•¡(Market value) <span class="unit">(?µì›)</span></label>
                <span class="form-tooltip" data-tooltip="?ì¥?€ ?ë™ ì§‘ê³„ Â· ë¹„ìƒ?¥ì? ?˜ê¸° ?…ë ¥">??/span>
                <input id="mktValue" type="number" min="0" inputmode="decimal" class="form-input" placeholder="?? 15200" />
              </div>
            </div>
          </section>

          <section class="kb-card card" aria-labelledby="autoCalcTitle">
            <h2 class="card__title" id="autoCalcTitle">?ë™ ê³„ì‚°</h2>
            <div class="kv-list autos">
              <div class="kv"><span>ë§¤ì¶œì´ì´??Gross Profit)</span><strong id="gp">-</strong><span class="badge-auto">?ë™ ê³„ì‚°??/span></div>
              <div class="kv"><span>ë§¤ì¶œì´ì´?µë¥ (Gross Profit Margin)</span><strong id="gpm">-</strong><span class="metric-badge" data-metric="gpm">-</span></div>
              <div class="kv"><span>?œì´?µë¥ (Net Profit Margin)</span><strong id="npm">-</strong><span class="metric-badge" data-metric="npm">-</span></div>
              <div class="kv"><span>? ë™ë¹„ìœ¨(Current Ratio)</span><strong id="cr">-</strong><span class="metric-badge" data-metric="cr">-</span></div>
              <div class="kv"><span>?¹ì¢Œë¹„ìœ¨(Quick Ratio)</span><strong id="qr">-</strong><span class="metric-badge" data-metric="qr">-</span></div>
              <div class="kv"><span>ë¶€ì±??ì‚°ë¹„ìœ¨(Debt to Asset Ratio)</span><strong id="dar">-</strong><span class="metric-badge" data-metric="dar">-</span></div>
              <div class="kv"><span>ì´ì?°ì´?µë¥ (ROA)</span><strong id="roa">-</strong><span class="metric-badge" data-metric="roa">-</span></div>
              <div class="kv"><span>?ŒíŠ¸ë§?Z-Score</span><strong id="altman">-</strong><span class="metric-badge" data-metric="altman">-</span></div>
              <div class="kv"><span>?¬ìŠ¨ O-Score</span><strong id="olson">-</strong><span class="metric-badge" data-metric="olson">-</span></div>
            </div>
          </section>
  </div>
{% endblock %}

{% block main %}
  <section class="corp-main-grid">
    <section class="kb-card card summary-strip corp-area--gauge" aria-labelledby="summaryTitle">
          <div class="summary-strip__header">
            <h2 class="card__title" id="summaryTitle">ê¸°ì—… ?¬ì‚¬ ?”ì•½</h2>
            <span class="summary-hint">ë¶€?„í™•ë¥?PD) ????„?˜ë¡ ?‘í˜¸</span>
          </div>
          <div class="summary-strip__body">
            <div class="summary-strip__gauge">
              <div class="chart-frame chart-frame--gauge" id="corpGaugeWrap">
                <div id="summaryGauge" style="width: 100%; height: 220px;"></div>
                <div id="summaryGrade" class="kb-meta"></div>
                <div id="summaryThreshold" class="kb-meta"></div>
              </div>
            </div>
            <div class="summary-strip__metrics">
              <div class="grade-badge" id="gradeBadge">--</div>
              <div id="amountBox" class="kb-amount-box">
                <div class="kb-amount-box__row">
                  <span>?”ì²­ ê¸ˆì•¡</span><strong id="askedAmountText">??</strong>
                </div>
                <div class="kb-amount-box__row">
                  <span>AI ì¶”ì²œ ?œë„</span><strong id="aiLimitText">??</strong>
                </div>
              </div>
              <div class="summary-metrics">
                <div class="metric">
                  <span class="metric-label">ê¶Œê³  ?œë„</span>
                  <strong class="metric-value" id="summaryLimit">-</strong>
                </div>
                <div class="metric">
                  <span class="metric-label">ê¶Œê³  ê¸ˆë¦¬</span>
                  <strong class="metric-value" id="summaryRate">-</strong>
                </div>
                <div class="metric">
                  <span class="metric-label">?„ìˆ˜ ?½ì •</span>
                  <strong class="metric-value" id="summaryCovenant">-</strong>
                </div>
              </div>
              <p class="summary-note">ê¶Œê³  ?œë„/ê¸ˆë¦¬???´ë? ëª¨ë¸ ê²°ê³¼ë¡? ?¹ì¸ê¶Œì ê²€? ê? ?„ìš”?©ë‹ˆ??</p>
              <div class="policy-flags" id="policyFlags" aria-live="polite"></div>
            </div>
          </div>
        </section>
    <section class="kb-card card corp-area--whatif" aria-labelledby="whatIfTitle">
          <div class="card-header">
            <h2 class="card__title" id="whatIfTitle">What-if ?œë‚˜ë¦¬ì˜¤</h2>
            <span class="hint">?¬ë¼?´ë” ì¡°ì • ??0.3ì´????ë™ ë°˜ì˜</span>
          </div>
      <div id="whatIfPanel">
        <div class="whatif-controls">
            <div class="whatif-row">
              <label for="revDelta">ë§¤ì¶œ ?±ì¥ë¥??%</label>
              <input id="revDelta" type="range" min="-20" max="20" value="0" />
              <span class="delta-chip" id="revDeltaVal">0%</span>
            </div>
            <div class="whatif-row with-toggle">
              <div class="whatif-label-group">
                <label for="marginDelta">ë§ˆì§„ ?%p</label>
                <div class="toggle-tabs" role="tablist">
                  <button type="button" class="toggle-tab active" id="marginModeGPM" data-mode="gpm">ë§¤ì¶œì´ì´?µë¥ </button>
                  <button type="button" class="toggle-tab" id="marginModeNPM" data-mode="npm">?œì´?µë¥ </button>
                </div>
              </div>
              <input id="marginDelta" type="range" min="-10" max="10" value="0" />
              <span class="delta-chip" id="marginDeltaVal">0%p</span>
            </div>
            <div class="whatif-row">
              <label for="debtDelta">?¥ê¸°ì°¨ì…ê¸??(?µì›)</label>
              <input id="debtDelta" type="range" min="-500" max="500" step="10" value="0" />
              <span class="delta-chip" id="debtDeltaVal">0</span>
            </div>
            <div class="whatif-row">
              <label for="mktDelta">?œê?ì´ì•¡ ?%</label>
              <input id="mktDelta" type="range" min="-20" max="20" value="0" />
              <span class="delta-chip" id="mktDeltaVal">0%</span>
            </div>
            <div class="whatif-row optional">
              <label for="fxDelta">?˜ìœ¨ ?%</label>
              <input id="fxDelta" type="range" min="-15" max="15" value="0" />
              <span class="delta-chip" id="fxDeltaVal">0%</span>
            </div>
            <div class="whatif-row optional">
              <label for="baseRateDelta">ê¸°ì?ê¸ˆë¦¬ ?%p</label>
              <input id="baseRateDelta" type="range" min="-3" max="3" step="0.1" value="0" />
              <span class="delta-chip" id="baseRateDeltaVal">0%p</span>
            </div>
          </div>
          <div class="whatif-summary" id="whatIfSummary">
            <span class="whatif-pill">PD ë³€?? 0%p</span>
            <span class="whatif-pill">?±ê¸‰ ë³€?? 0?¨ê³„</span>
            <span class="whatif-pill">ê¶Œê³  ?œë„: ë³€???†ìŒ</span>
          </div>
      </div>
    </section>
    <article class="card corp-area--risk">
      <h3 class="card__title">?“Š ê¸°ì—… ?„í—˜???¬ë¬´ ê¸°ë°˜)</h3>
      <div id="summaryRiskRadar" style="width: 100%; height: 280px;"></div>
    </article>
  </section>
  <section class="corp-financial-row">
    <article class="card">
      <h3 class="card__title">?¬ë¬´ ?”ì•½</h3>
      <ul id="corpFinancialSummary" class="kb-list" role="list"></ul>
    </article>
  </section>


  <section class="kb-card card" aria-labelledby="xaiTitle">
          <div class="card-header">
            <h2 class="card__title" id="xaiTitle">?¤ëª… ê°€?¥ì„± (XAI)</h2>
            <div class="tabs" role="tablist">
              <button id="tabShap" type="button" class="tab active" role="tab" aria-controls="shapBar" aria-selected="true">SHAP ?”ì¸</button>
              <button id="tabFI" type="button" class="tab" role="tab" aria-controls="fiChart" aria-selected="false">Feature Importance</button>
            </div>
          </div>
          <div class="chart-frame chart-frame--wide" id="shapWrap">
            <div id="shapBar" class="kb-chart" role="img" aria-label="SHAP Top-K ë§‰ë? ì°¨íŠ¸"></div>
          </div>
          <div class="chart-frame chart-frame--wide" id="fiWrap" style="display:none;">
            <div id="fiChart" class="kb-chart" role="img" aria-label="Feature Importance ë§‰ë? ì°¨íŠ¸"></div>
          </div>
          <p class="hint">SHAP: ê¸°ì—…ë³??í–¥??/ Feature Importance: ?„ì—­ ì¤‘ìš”??/p>
        </section>

  <section class="kb-card card" aria-labelledby="financeSummaryTitle">
          <h2 class="card__title" id="financeSummaryTitle">?¬ë¬´ ?”ì•½</h2>
          <div class="two-col-charts">
            <div class="chart-frame chart-frame--square">
              <div id="ratioRadar" class="kb-chart" role="img" aria-label="?¬ë¬´ ë¹„ìœ¨ ?ˆì´??ì°¨íŠ¸"></div>
            </div>
            <div class="chart-frame chart-frame--wide">
              <div id="trendLine" class="kb-chart" role="img" aria-label="?¬ë¬´ ì¶”ì´ ?¼ì¸ ì°¨íŠ¸"></div>
            </div>
          </div>
          <div class="chart-frame chart-frame--wide optional" id="peerFrame">
            <div id="peerScatter" class="kb-chart" role="img" aria-label="?…ì¢… ì¤‘ìœ„???€ë¹??¬ì???></div>
          </div>
        </section>

  <section class="kb-card card" aria-labelledby="collateralTitle">
          <h2 class="card__title" id="collateralTitle">?´ë³´ Â· ì§‘ì¤‘??/h2>
          <div class="collateral-layout">
            <div class="collateral-card">
              <h3>?´ë³´ ?„í™©</h3>
              <ul class="collateral-list" id="collateralList">
                <li>?´ë³´ ?•ë³´ë¥?ë¶ˆëŸ¬?¤ë©´ ì¢…ë¥˜/?‰ê?ê°€ì¹?LTVê°€ ?œì‹œ?©ë‹ˆ??</li>
              </ul>
              <p class="hint">Â±10% ë¯¼ê°??ë¶„ì„ ê²°ê³¼???¨ê»˜ ?œê³µ?©ë‹ˆ??</p>
            </div>
            <div class="chart-frame chart-frame--wide">
              <div id="concentrationHeatmap" class="kb-chart" role="img" aria-label="ì§‘ì¤‘???ˆíŠ¸ë§?></div>
            </div>
          </div>
        </section>
{% endblock %}

{% block right_panel %}
  {% include 'ui/right_panel.html' with panel=panel %}
{% endblock %}


